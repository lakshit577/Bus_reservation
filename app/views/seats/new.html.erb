<h1>Seats for <%= @bus.bus_name %></h1>
<br>
<%= form_with url: new_bus_seat_path(@bus), method: :get, local: true do |form| %>
  <div class="form-group">
    <h4><%= form.label :date, "Select Date" %></h4>
    <%= form.date_field :date, value: Date.today.strftime('%Y-%m-%d'), class: "form-control" %>
  </div>
  <br>
  <%= form.submit "View Available Seats", class: "btn btn-primary" %>
<% end %>
<br>
<%= form_with url: bus_seats_path(@bus), method: :post, local: true, id: "seats-form" do %> <!-- Changed method to :post -->
  <div id="seats-container">
    <% if @seats.any? && @date >= Date.today.strftime("%Y-%m-%d") %>
      <div class="seats-grid">
        <% @seats.each do |seat| %>
          <div class="seat-checkbox">
            <label>
              <%= check_box_tag "seats[]", seat.id, false, class: "seat-checkbox-input", data: { seat_id: seat.id, seat_number: seat.seat_number } %>
              <span class="seat-number"><%= seat.seat_number %></span>
            </label>
          </div>
        <% end %>
      </div>
    <% else %>
      <p>No seats available for the selected date.</p>
    <% end %>
  </div>
  <br>

  <%= hidden_field_tag :date, @date %> <!-- Hidden field for date -->
  <div class="actions">
    <%= submit_tag "pay Amount for seats", class: "btn btn-primary" %>
  </div>
<% end %>
<br>

<%= link_to "Back to Bus", bus_path(@bus), class: "btn btn-secondary" %>

<style>
  .seats-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .seat-checkbox {
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ccc;
    padding: 10px;
    cursor: pointer;
  }
  .seat-checkbox input[type="checkbox"] {
    display: none;
  }
  .seat-checkbox label {
    padding: 5px;
  }
  .seat-checkbox.checked {
    background-color: red;
    color: white;
  }
</style>

<script>
  function attachSeatCheckboxHandlers() {
    document.querySelectorAll('.seat-checkbox label').forEach(function(label) {
      label.addEventListener('click', function(event) {
        event.preventDefault();
        const checkbox = label.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        label.closest('.seat-checkbox').classList.toggle('checked', checkbox.checked);
      });
    });
  }

  document.addEventListener("DOMContentLoaded", function() {
    attachSeatCheckboxHandlers();

    document.querySelector('#seats-form').addEventListener('submit', function(event) {
      const checkedSeats = document.querySelectorAll('.seat-checkbox-input:checked');
      if (checkedSeats.length === 0) {
        event.preventDefault();
        alert("Please select at least one seat.");
      }
    });
  });
</script>


